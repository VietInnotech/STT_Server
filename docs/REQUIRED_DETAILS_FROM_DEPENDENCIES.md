# Required Details from Android App & MAIE Server

**Date:** November 27, 2025  
**Purpose:** Specifications needed to create concrete, implementation-ready integration plan

---

## From Android App Team

### 1. Current Upload Implementation

**NEED TO KNOW:**

- [ ] **Current upload endpoint being used**: Is it `/api/files/text-pair-android` or a custom flow?
- [ ] **Current payload structure**: What does the Android app actually send? Example:
  ```json
  {
    "summary": "...",
    "realtime": "...",
    "deviceId": "...",
    "deleteAfterDays": 30,
    "pairName": "..."
  }
  ```
- [ ] **Any other fields being sent**: Are there fields beyond `summary`, `realtime`, `deviceId`?
- [ ] **Error handling**: How does Android handle 400/403/429 responses?

### 2. Processing & Results Generation

**NEED TO KNOW:**

- [ ] **MAIE integration method**:

  - Does Android send audio directly to MAIE, or does it go through Report Server?
  - What is the exact MAIE endpoint URL and authentication method?
  - Example flow: `Android → MAIE /v1/transcribe` or `Android → ReportServer → MAIE`?

- [ ] **MAIE result structure**: What exact JSON does MAIE return after processing?

  ```json
  {
    "transcript": "...",
    "summary": "...",
    "title": "...",
    "tags": ["..."],
    "confidence": 0.95,
    ...?
  }
  ```

- [ ] **Template application**: How does Android know which template to use?

  - User selects before recording?
  - Default per device?
  - Fetched from Report Server?

- [ ] **Result caching**: Does Android cache results locally before uploading?
  - If upload fails, how long are results held?
  - Is there a queue/retry mechanism?

### 3. Audio File Handling

**NEED TO KNOW:**

- [ ] **Audio format/quality**: What format does Android record?

  - WAV, MP3, OGG, AAC?
  - Sample rate, bitrate, channels?
  - Average file size for 1 minute of audio?

- [ ] **Audio → Server path**:

  - Does Android upload audio separately via `/api/files/audio`?
  - Or only the processed text via `/api/files/text-pair-android`?
  - Can we make audio upload optional?

- [ ] **Offline capability**: If audio cannot be sent to MAIE immediately:
  - Does Android store audio locally?
  - How long before attempting upload?
  - Is there an offline queue?

### 4. Metadata & Tags

**NEED TO KNOW:**

- [ ] **Where do tags come from?**

  - Generated by MAIE (automatic)?
  - User input (user selects before recording)?
  - Device type / location based?
  - Combination?

- [ ] **Tag format**:

  - Are they free-form strings or from a predefined list?
  - Max number of tags per result?
  - Example tags: `["meeting", "Q4-review", "2025-11-27"]`?

- [ ] **Title generation**:
  - Generated by MAIE?
  - Default to first N characters of summary?
  - User can edit?

### 5. User Experience & Workflow

**NEED TO KNOW:**

- [ ] **What does user see after recording?**

  ```
  Android Flow:
  1. Record → [progress] → Results page
     - What info is shown?
     - Can user edit title/tags before upload?
     - Is there a preview of transcript?

  2. Upload → [progress] → Confirmation
     - What feedback is shown?
     - Can user view uploaded results?
  ```

- [ ] **Syncing with Report Server UI**:
  - Can user see uploaded results in web UI immediately?
  - How long does sync take?
  - Can Android access its own upload history?

### 6. Device & Session Management

**NEED TO KNOW:**

- [ ] **Device ID tracking**:

  - How is deviceId generated/stored on Android?
  - Is it per-device or per-app-instance?
  - Does it persist across app reinstalls?
  - Sent with every upload?

- [ ] **Authentication**:
  - How is JWT obtained on Android?
  - How long is token valid?
  - How does Android handle token refresh?
  - Does each Android app instance have separate token?

---

## From MAIE Server Team

### 1. API Endpoint Specifications

**NEED TO KNOW:**

- [ ] **All available endpoints** (not just templates):

  ```
  POST /v1/transcribe         ← Audio to text?
  POST /v1/summarize          ← Text to summary?
  POST /v1/analyze            ← Get tags/title?
  GET  /v1/templates          ← Listed endpoints (✅)
  ???  ???
  ```

- [ ] **For each endpoint**, provide:
  - Exact URL path
  - HTTP method
  - Authentication (API key location, format)
  - Request body format with examples
  - Response body format with examples
  - Error responses (4xx/5xx codes and messages)
  - Rate limits (requests/minute)
  - Timeout/SLA

### 2. Processing & Output

**NEED TO KNOW:**

- [ ] **Audio transcription endpoint**:

  ```yaml
  POST /v1/transcribe
  Authorization: X-API-Key: <key>
  Content-Type: ?               ← multipart/form-data or application/json (base64)?

  Request:
    audio: <file or base64>
    language?: string           ← en, vi, auto?
    model?: string              ← fast, standard, accurate?
    template_id?: string        ← optional template?
    ???

  Response:
    transcript: string
    confidence: number          ← 0-1?
    language: string
    duration: number            ← seconds?
    words: Array<{word, confidence, timestamp}>  ← word-level detail?
    ???
  ```

- [ ] **Text summarization endpoint**:

  ```yaml
  POST /v1/summarize

  Request:
    text: string
    template_id?: string
    style?: string              ← "bullet", "paragraph", "abstract"?
    max_length?: number
    ???

  Response:
    summary: string
    title: string               ← Generated title?
    tags: string[]              ← Auto-generated tags?
    key_points: string[]        ← Bullet points?
    confidence: number
    ???
  ```

- [ ] **Tag/metadata extraction**:
  - Is this a separate endpoint?
  - Or included in summarize response?
  - What algorithm? (keyword extraction, ML-based, etc.)

### 3. Template System

**NEED TO KNOW:**

- [ ] **Template structure**:

  ```json
  {
    "id": "tpl-meeting-notes",
    "name": "Meeting Notes",
    "schema_data": {
      // JSON Schema for structured output
      "type": "object",
      "properties": {
        "attendees": { "type": "array" },
        "decisions": { "type": "array" },
        "action_items": { "type": "array" },
        ...
      }
    },
    "prompt_template": "Extract meeting info...",
    "example": { ... }
  }
  ```

  - Is this structure correct?
  - What other fields are in template?

- [ ] **Template usage**:

  - When user selects template, does it guide the output structure?
  - Example: Template for "meeting" → output includes attendees, decisions, action_items?
  - Or just a label/reference?

- [ ] **Custom templates**:
  - Can users/admins create custom templates?
  - Endpoint: `POST /v1/templates`? (assuming yes from code)
  - Rate limits on template creation?

### 4. Processing Performance

**NEED TO KNOW:**

- [ ] **Processing times**:

  - Typical: 1 minute audio = ? seconds to process
  - Range: min to max
  - P95/P99 latencies?
  - Does longer audio take proportionally longer?

- [ ] **Concurrent request limits**:

  - Max concurrent processing requests?
  - Queuing behavior if overloaded?

- [ ] **Output quality**:
  - How do you measure confidence scores (0-1 scale)?
  - What confidence threshold indicates "low quality"?
  - Any known limitations (e.g., accents, background noise)?

### 5. Error Handling & Status

**NEED TO KNOW:**

- [ ] **Processing states**:

  ```
  - pending: queued for processing?
  - processing: in progress?
  - completed: success?
  - failed: error occurred?
  - timeout: took too long?
  - Any others?
  ```

- [ ] **Error messages**:

  - Example error responses for common failures:
    - Invalid audio format
    - Unsupported language
    - Audio too long/short
    - API key invalid
    - Rate limit exceeded

- [ ] **Async vs Sync**:
  - Does `/v1/transcribe` return immediately or wait for processing?
  - If async, how to get results? Webhook? Polling? Streaming?

### 6. Data Retention & Privacy

**NEED TO KNOW:**

- [ ] **What MAIE stores**:

  - Does MAIE keep copies of audio files?
  - How long are results retained?
  - Can results be deleted?
  - GDPR compliance? Right to be forgotten?

- [ ] **Audit/logging**:
  - Does MAIE log who processed what audio?
  - Available for reporting?

### 7. Cost/Quotas

**NEED TO KNOW:**

- [ ] **Usage tracking**:

  - Can Report Server query usage stats?
  - Are there per-user quotas?
  - Cost per 1000 words transcribed / summarized?

- [ ] **Rate limiting**:
  - Global limit per API key?
  - Per-user limits if multi-tenant?
  - Burst allowance?

---

## Data Flow Clarifications

### Question 1: Audio Processing Location

```
OPTION A: Android → MAIE directly
┌─────────┐     Audio      ┌──────┐
│ Android │──────────────►│ MAIE │
└────┬────┘               └──┬───┘
     │                        │
     │        Results          │
     │◄───────{text}───────────┘
     │
     ▼
Report Server (POST /api/files/processing-result)


OPTION B: Android → Report Server → MAIE
┌─────────┐      Audio      ┌──────────┐     Audio      ┌──────┐
│ Android │───────────────►│ ReportSrv │──────────────►│ MAIE │
└────┬────┘                └────┬─────┘               └──┬───┘
     │                          │                        │
     │        Results           │       Results          │
     │◄─────{text}──────────────┤◄────{text}─────────────┘
     │                          │
     └──────────────────────────┘


QUESTION: Which one is currently happening?
```

**Need to know:**

- Does Android have MAIE API key, or does it go through Report Server?
- Should audio be stored in Report Server before sending to MAIE, or sent directly?
- If MAIE fails, can Report Server retry automatically?

### Question 2: Result Metadata Availability

```
When MAIE returns processed results, does it include:

✅ Confirmed - from code review:
- transcript (realtime)
- summary
- confidence
- processing_time_ms

❓ Unknown - need confirmation:
- title (auto-generated or user input?)
- tags (auto-extracted or provided?)
- template_id_used
- language_detected
- key_phrases / entities
- Any structured fields from template?
```

### Question 3: Offline & Retry Logic

```
Current scenario:
1. User records audio on Android
2. Sends to MAIE (success or fail?)
3. Sends to Report Server (success or fail?)

If step 2 fails:
- Does Android retry?
- How long does it wait?
- Does it keep audio locally?

If step 3 fails:
- Can Android retry with same results?
- How many times?
- User notification?
```

---

## Data Model Questions

### For ProcessingResult Model Design

**NEED TO KNOW:**

```prisma
model ProcessingResult {
  title        String?    // ← Is this from MAIE or user input?
  tags         Json?      // ← Format: ["tag1", "tag2"]? Or {tag1: true, tag2: true}?
  templateId   String?    // ← User selects before upload, or after MAIE processes?
  rawOutput    Json?      // ← How large can this be? (MB for a 1-hour audio?)
  confidence   Float?     // ← Always 0-1? Any fields beyond overall confidence?
  processingTime Int?     // ← In milliseconds? Includes network time or just MAIE time?
}
```

---

## Priority Ranking

If you can only answer some questions first, prioritize in this order:

### CRITICAL (blocks implementation)

1. ✅ Android current upload endpoint & payload format
2. ✅ MAIE → Android result structure (what fields exactly)
3. ✅ MAIE API endpoint URLs and auth
4. ✅ Audio → MAIE flow (direct or via Report Server)
5. ✅ Where do tags & title come from

### IMPORTANT (affects design)

6. ✅ Processing times (1 min audio → ? seconds)
7. ✅ Android offline/retry behavior
8. ✅ Async vs Sync processing model
9. ✅ Error codes and messages

### NICE-TO-HAVE (optimizations)

10. ✅ MAIE storage/retention policies
11. ✅ Concurrent request limits
12. ✅ Cost and quota structure

---

## Deliverables After Getting Answers

Once you provide the above details, I can create:

1. **Concrete API Contracts** - Exact request/response schemas for new endpoints
2. **Database Migration** - Specific Prisma schema changes with field types and constraints
3. **Implementation Checklist** - Step-by-step code changes for each file
4. **Android Integration Guide** - Exact payloads Android should send
5. **Error Handling Matrix** - How to handle each MAIE error gracefully
6. **Deployment Sequence** - Order to roll out changes safely
7. **Rollback Procedures** - How to revert if issues occur
8. **Testing Scenarios** - Test cases for each integration point

---

## Answer Template

Please provide responses in this format:

````markdown
## Android App Answers

### 1. Current Upload Implementation

- **Current endpoint**: [endpoint or description]
- **Current payload**:
  ```json
  [example]
  ```
````

- **Other fields**: [list any additional fields]

### 2. Processing & Results Generation

- **MAIE integration flow**: [description or diagram]
- **MAIE result structure**:
  ```json
  [example response from MAIE]
  ```
- **Template selection**: [how is template chosen]
- **Result caching**: [details about offline handling]

[... etc for each section ...]

## MAIE Server Answers

### 1. API Endpoint Specifications

#### POST /v1/transcribe

- **Authentication**: [how]
- **Request format**:
  ```json
  [example]
  ```
- **Response format**:
  ```json
  [example]
  ```
- **Processing time**: [1 min audio = X seconds]
- **Error codes**: [401, 429, etc.]

[... etc for each endpoint ...]

```

---

**Once these details are provided, I can create a fully concrete implementation plan with exact code examples, database migrations, and step-by-step deployment instructions.**
```
